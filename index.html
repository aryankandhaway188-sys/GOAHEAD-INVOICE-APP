<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Freight Forwarding Invoice App</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-5">

    <div class="max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-lg">
        <h1 class="text-2xl font-bold mb-6 text-blue-600 border-b pb-2">Freight Invoice Generator</h1>
        
        <div class="grid grid-cols-2 gap-4 mb-6">
            <input id="shipper" type="text" placeholder="Shipper Name" class="border p-2 rounded">
            <input id="consignee" type="text" placeholder="Consignee Name" class="border p-2 rounded">
            <input id="container" type="text" placeholder="Container Number" class="border p-2 rounded">
            <input id="hbl" type="text" placeholder="HBL / Bill of Lading No." class="border p-2 rounded">
            <input id="freight" type="number" placeholder="Ocean Freight (INR)" class="border p-2 rounded">
            <input id="local" type="number" placeholder="Local Charges (INR)" class="border p-2 rounded">
        </div>

        <button onclick="saveInvoice()" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">Save & Download PDF</button>

        <hr class="my-8">

        <h2 class="text-xl font-semibold mb-4">Saved Invoices (History)</h2>
        <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-gray-200">
                        <th class="p-2 border">Shipper</th>
                        <th class="p-2 border">Container</th>
                        <th class="p-2 border">Total Amount</th>
                        <th class="p-2 border">Action</th>
                    </tr>
                </thead>
                <tbody id="historyTable">
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        const { jsPDF } = window.jspdf;

        // Load Data on Startup
        window.onload = displayHistory;

        function saveInvoice() {
            const invoiceData = {
                shipper: document.getElementById('shipper').value,
                consignee: document.getElementById('consignee').value,
                container: document.getElementById('container').value,
                hbl: document.getElementById('hbl').value,
                freight: document.getElementById('freight').value || 0,
                local: document.getElementById('local').value || 0,
                total: parseFloat(document.getElementById('freight').value || 0) + parseFloat(document.getElementById('local').value || 0),
                date: new Date().toLocaleDateString()
            };

            if(!invoiceData.shipper) return alert("Please enter Shipper Name");

            // Save to LocalStorage
            let invoices = JSON.parse(localStorage.getItem('myInvoices') || "[]");
            invoices.push(invoiceData);
            localStorage.setItem('myInvoices', JSON.stringify(invoices));

            generatePDF(invoiceData);
            displayHistory();
        }

        function generatePDF(data) {
            const doc = new jsPDF();
            doc.setFontSize(20);
            doc.text("FREIGHT INVOICE", 105, 20, { align: 'center' });
            
            doc.setFontSize(12);
            doc.text(Date: ${data.date}, 20, 40);
            doc.text(Shipper: ${data.shipper}, 20, 50);
            doc.text(Consignee: ${data.consignee}, 20, 60);
            doc.text(Container No: ${data.container}, 20, 70);
            doc.text(HBL No: ${data.hbl}, 20, 80);
            
            doc.line(20, 90, 190, 90);
            doc.text(Ocean Freight: INR ${data.freight}, 20, 100);
            doc.text(Local Charges: INR ${data.local}, 20, 110);
            doc.setFontSize(14);
            doc.text(TOTAL AMOUNT: INR ${data.total}, 20, 130);
            
            doc.save(Invoice_${data.container}.pdf);
        }

        function displayHistory() {
            let invoices = JSON.parse(localStorage.getItem('myInvoices') || "[]");
            const table = document.getElementById('historyTable');
            table.innerHTML = "";

            invoices.reverse().forEach((inv, index) => {
                table.innerHTML += `
                    <tr>
                        <td class="p-2 border">${inv.shipper}</td>
                        <td class="p-2 border">${inv.container}</td>
                        <td class="p-2 border">â‚¹${inv.total}</td>
                        <td class="p-2 border text-blue-500 cursor-pointer" onclick="downloadAgain(${index})">Download</td>
                    </tr>
                `;
            });
        }

        function downloadAgain(index) {
            let invoices = JSON.parse(localStorage.getItem('myInvoices') || "[]").reverse();
            generatePDF(invoices[index]);
        }
    </script>
</body>
</html>
